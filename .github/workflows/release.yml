name: Release

on:
  push:
    tags:
      - 'v*.*.*'

jobs:
  create-release:
    name: Create Release
    runs-on: ubuntu-latest
    permissions:
      contents: write
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    
    - name: Extract version
      id: version
      run: |
        VERSION=${GITHUB_REF#refs/tags/v}
        echo "VERSION=$VERSION" >> $GITHUB_OUTPUT
    
    - name: Create Release Notes
      run: |
        cat > release_notes.md << 'EOF'
        # VoiceDM v${{ steps.version.outputs.VERSION }} Release
        
        ## ðŸª¶ Featherweight Hybrid AI Architecture
        
        ### Key Features
        - **Zero Dependencies by Default** - Works without API keys
        - **Three Narration Modes** - template/hybrid/llm
        - **<1ms Response Time** - Template mode
        - **$0 Cost** - Template mode
        - **All Intelligence Preserved** - Imagination, railroading, frames
        
        ### What's New
        See [CHANGELOG.md](CHANGELOG.md) for full details.
        
        ### Installation
        ```bash
        pip install -r requirements.txt
        uvicorn server.main:app --host 0.0.0.0 --port 8000
        ```
        
        ### Documentation
        - [FEATHERWEIGHT_GUIDE.md](FEATHERWEIGHT_GUIDE.md) - Architecture guide
        - [QUICK_START_v1.3.0.md](QUICK_START_v1.3.0.md) - Quick reference
        - [UPGRADE_v1.3.0.md](UPGRADE_v1.3.0.md) - Migration guide
        
        ### Testing
        All tests passing:
        - Zero-dependency operation verified
        - Math & logic verification complete
        - Template coverage validated
        - Integration tests passed
        EOF
    
    - name: Create GitHub Release
      uses: softprops/action-gh-release@v1
      with:
        body_path: release_notes.md
        draft: false
        prerelease: false
        generate_release_notes: true
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
